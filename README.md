# bg2 file input/output

Standalone C++ library for reading and writing `.bg2` files, the native file format of the graphics engine [bg2 engine](https://www.bg2engine.org).

## Build and debug

This project is ready for build with Visual Studio Code on Linux and macOS. Select the appropiate debug and/or build task to build it.

You will need the Microsoft extensions for C++. Also, for macOS the project is configured to use the `CodeLLDB` extension for debug, because the Microsoft extension don't work fine on Apple Silicon processors.

For Windows, there is a project for Visual Studio.

However, the code does not have any dependencies, nor does it require any macros to be configured. You can make it work in any other environment by simply adding the C files to the building system or IDE of your choice.

## WebAssembly JavaScript library

You need to install and configure [emscripten](https://emscripten.org) and [nodejs](https://nodejs.org/en/) in your system. The build script is prepared for work on macOS, Linux and WSL, but you probably can create a Windows command line bat script, based on `src/wasm/build.sh`. However, I recommend using WSL if you are on Windows. Note that the resulting code will be platform independent.

```sh
cd src/wasm
npm ci
npm run build
```

This will generate the following output files:

- bin/wasm/bg2io/   Distribution package
    |- bg2io.js
    |- bg2io.wasm
    |- Bg2ioBrowser.js
    |- Bg2ioModule.cjs
    |- Bg2ioModule.wasm
    |- Bg2ioWrapper.mjs
- bin/wasm
    |- example-browser.js
    |- index.html            Example website

### Test example on web browser

You can open `index.html` using a local web server (for example, using the Live Server Visual Studio Code extension) to test the example on the browser. Open de JavaScript console to view the example output.

If you want to create a website using webpack/rollup/gulp/whatever, you need to import the `Bg2ioBrowser.js` in your code, but its important to distribute also the `bg2io.js` and `bg2io.wasm` files with the rest of your code. These files must be placed next to the main JavaScript file generated by webpack/rollup. If not, you must pass the path to these files when you are going to use the library:

```js
import Bg2ioBrowser from 'path/to/Bg2ioBrowser.js'

const wrapper = await Bg2ioBrowser({ wasmPath: 'path/to/bg2io/files' });
...
```

The included browser example places the `bg2io.*` files in another directory on purpose, so you can see a working example if this is your case. If you place all `js` and `wasm` files in the same location, you don't need to pass the `wasmPath` parameter.

### Test example with Node.js

Note: You can run the node example AFTER running the build script.

```sh
cd src/wasm
node example-node.js
```


